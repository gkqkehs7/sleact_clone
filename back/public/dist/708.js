"use strict";(self.webpackChunksleact_ts_front=self.webpackChunksleact_ts_front||[]).push([[708],{65256:function(t,e,n){n.r(e),n.d(e,{default:function(){return E}});var a=n(67294),r=n(5977),o=n(66482),l=(0,o.Z)("div",{target:"exhfy1p2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),c=(0,o.Z)("header",{target:"exhfy1p1"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"}),i=(0,o.Z)("div",{target:"exhfy1p0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"}),s=n(8100),u=n(44593),f=n(83564),d=n(92309),p=n(32545),h=n(38678),m=n(9669),g=n.n(m),v=n(6501),y=n(32951),b=n(79250),w=n(63750),x=n(39249),T=(n(55202),n(2599));function k(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var a,r,o=[],l=!0,c=!1;try{for(n=n.call(t);!(l=(a=n.next()).done)&&(o.push(a.value),!e||o.length!==e);l=!0);}catch(t){c=!0,r=t}finally{try{l||null==n.return||n.return()}finally{if(c)throw r}}return o}}(t,e)||S(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){if(t){if("string"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}var E=function(){var t,e,n,o=(0,r.UO)(),m=o.workspace,E=o.channel,Z=(0,s.ZP)("".concat(T.T,"/api/users"),f.Z).data,I=(0,s.ZP)("".concat(T.T,"/api/workspaces/").concat(m,"/channels"),f.Z).data,A=(0,u.ZP)((function(t){return"".concat(T.T,"/api/workspaces/").concat(m,"/channels/").concat(E,"/chats?perPage=20&page=").concat(t+1)}),f.Z),D=A.data,j=A.mutate,B=A.setSize,_=(0,s.ZP)(Z?"".concat(T.T,"/api/workspaces/").concat(m,"/channels/").concat(E,"/members"):null,f.Z).data,O=k((0,y.Z)(m),1)[0],P=k((0,h.Z)(""),3),R=P[0],U=P[1],z=P[2],M=k((0,a.useState)(!1),2),F=M[0],H=M[1],V=k((0,a.useState)(!1),2),W=V[0],L=V[1],Y=(0,a.useRef)(null),$=0===(null==D||null===(t=D[0])||void 0===t?void 0:t.length),q=$||D&&(null===(e=D[D.length-1])||void 0===e?void 0:e.length)<20,G=(0,a.useCallback)((function(t){if(t.preventDefault(),null!=R&&R.trim()&&D&&I&&Z){var e=R;j((function(t){var n;return null==t||t[0].unshift({id:((null===(n=D[0][0])||void 0===n?void 0:n.id)||0)+1,content:e,UserId:Z.id,User:Z,createdAt:new Date,ChannelId:I.id,Channel:I}),t}),!1).then((function(){var t;localStorage.setItem("".concat(m,"-").concat(E),(new Date).getTime().toString()),z(""),Y.current&&(console.log("scrollToBottom!",null===(t=Y.current)||void 0===t?void 0:t.getValues()),Y.current.scrollToBottom())})),g().post("".concat(T.T,"/api/workspaces/").concat(m,"/channels/").concat(E,"/chats"),{content:e}).catch(console.error)}}),[R,m,E,I,Z,D,j,z]);(0,a.useEffect)((function(){localStorage.setItem("".concat(m,"-").concat(E),(new Date).getTime().toString())}),[m,E]);var J=(0,a.useCallback)((function(t){t.Channel.name===E&&(t.content.startsWith("uploads\\")||t.content.startsWith("uploads/")||t.UserId!==(null==Z?void 0:Z.id))&&j((function(e){return console.log("메세지 도착!"),null==e||e[0].unshift(t),e}),!1).then((function(){var t;Y.current&&(Y.current.getScrollHeight()<Y.current.getClientHeight()+Y.current.getScrollTop()+150?(console.log("scrollToBottom!",null===(t=Y.current)||void 0===t?void 0:t.getValues()),setTimeout((function(){var t;null===(t=Y.current)||void 0===t||t.scrollToBottom()}),100)):x.Am.success("새 메시지가 도착했습니다.",{onClick:function(){var t;null===(t=Y.current)||void 0===t||t.scrollToBottom()},closeOnClick:!0}))}))}),[E,Z,j,G]);(0,a.useEffect)((function(){return null==O||O.on("chat",J),function(){null==O||O.off("chat",J)}}),[O,J]),(0,a.useEffect)((function(){var t;1===(null==D?void 0:D.length)&&(null===(t=Y.current)||void 0===t||t.scrollToBottom())}),[D]);var K,N=(0,v.Z)(D?(n=[]).concat.apply(n,(K=D,function(t){if(Array.isArray(t))return C(t)}(K)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(K)||S(K)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).reverse():[]),Q=(0,a.useCallback)((function(){H(!0)}),[]),X=(0,a.useCallback)((function(){H(!1)}),[]),tt=(0,a.useCallback)((function(t){t.preventDefault();var e=new FormData;if(t.dataTransfer.items){for(var n=0;n<t.dataTransfer.items.length;n++)if("file"===t.dataTransfer.items[n].kind){var a=t.dataTransfer.items[n].getAsFile();e.append("image",a)}}else for(var r=0;r<t.dataTransfer.files.length;r++)e.append("image",t.dataTransfer.files[r]);g().post("".concat(T.T,"/api/workspaces/").concat(m,"/channels/").concat(E,"/images"),e).then((function(){L(!1),localStorage.setItem("".concat(m,"-").concat(E),(new Date).getTime().toString())}))}),[m,E]),et=(0,a.useCallback)((function(t){console.log("드래그중"),t.preventDefault(),L(!0)}),[]);return I&&Z?a.createElement(l,{onDragOver:et,onDrop:tt},a.createElement(c,null,a.createElement("span",null,"#",E),a.createElement("div",{style:{display:"flex",flex:1,justifyContent:"flex-end",alignItems:"center"}},a.createElement("span",null,_&&_[0].Members.length),a.createElement(w.RYR,{onClick:Q,style:{marginLeft:"5px"}}))),a.createElement(p.Z,{chatData:N,scrollbarRef:Y,isReachingEnd:q,isEmpty:$,setSize:B}),a.createElement(d.Z,{chat:R,onChangeChat:U,onSubmitForm:G}),a.createElement(b.Z,{show:F,onCloseModal:X,setShowInviteChannelModal:H}),a.createElement(x.Ix,{position:"bottom-center",limit:1}),W&&a.createElement(i,null,"업로드!")):null}}}]);