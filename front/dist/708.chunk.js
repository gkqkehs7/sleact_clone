"use strict";(self.webpackChunksleact_ts_front=self.webpackChunksleact_ts_front||[]).push([[708],{65256:function(e,t,n){n.r(t),n.d(t,{default:function(){return C}});var a=n(67294),r=n(5977),o=n(66482),l=(0,o.Z)("div",{target:"exhfy1p2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),c=(0,o.Z)("header",{target:"exhfy1p1"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"}),i=(0,o.Z)("div",{target:"exhfy1p0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"}),s=n(8100),u=n(44593),f=n(83564),p=n(92309),m=n(32545),h=n(38678),d=n(9669),g=n.n(d),v=n(6501),y=n(32951),b=n(79250),w=n(63750),x=n(39249),k=n(2599);function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{l||null==n.return||n.return()}finally{if(c)throw r}}return o}}(e,t)||T(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var C=function(){var e,t,n,o=(0,r.UO)(),d=o.workspace,C=o.channel,Z=(0,s.ZP)("".concat(k.T,"/api/users"),f.Z).data,I=(0,s.ZP)("".concat(k.T,"/api/workspaces/").concat(d,"/channels"),f.Z).data,A=(0,u.ZP)((function(e){return"".concat(k.T,"/api/workspaces/").concat(d,"/channels/").concat(C,"/chats?perPage=20&page=").concat(e+1)}),f.Z),D=A.data,j=A.mutate,_=A.setSize;console.log(D);var O=(0,s.ZP)(Z?"".concat(k.T,"/api/workspaces/").concat(d,"/channels/").concat(C,"/members"):null,f.Z).data,P=S((0,y.Z)(d),1)[0],R=S((0,h.Z)(""),3),z=R[0],M=R[1],B=R[2],F=S((0,a.useState)(!1),2),U=F[0],L=F[1],Y=S((0,a.useState)(!1),2),$=Y[0],q=Y[1],G=(0,a.useRef)(null),H=0===(null==D||null===(e=D[0])||void 0===e?void 0:e.length),J=H||D&&(null===(t=D[D.length-1])||void 0===t?void 0:t.length)<20,K=(0,a.useCallback)((function(e){e.preventDefault(),null!=z&&z.trim()&&g().post("".concat(k.T,"/api/workspaces/").concat(d,"/channels/").concat(C,"/chats"),{content:z}).then((function(){j(),B(""),localStorage.setItem("".concat(d,"-").concat(C),(new Date).getTime().toString()),setTimeout((function(){var e;null===(e=G.current)||void 0===e||e.scrollToBottom()}),100)})).catch(console.error)}),[z]);(0,a.useEffect)((function(){localStorage.setItem("".concat(d,"-").concat(C),(new Date).getTime().toString())}),[d,C]);var N=(0,a.useCallback)((function(e){j((function(t){return null==t||t[0].push(e),localStorage.setItem("".concat(d,"-").concat(C),(new Date).getTime().toString()),t}),!1).then((function(){x.Am.success("새 메시지가 도착했습니다.",{onClick:function(){var e;null===(e=G.current)||void 0===e||e.scrollToBottom()},closeOnClick:!0})}))}),[Z,j]);(0,a.useEffect)((function(){return null==P||P.on("chat",N),function(){null==P||P.off("chat",N)}}),[P,N]),(0,a.useEffect)((function(){var e;1===(null==D?void 0:D.length)&&(null===(e=G.current)||void 0===e||e.scrollToBottom())}),[D]);var Q,V=(0,v.Z)(D?(n=[]).concat.apply(n,(Q=D,function(e){if(Array.isArray(e))return E(e)}(Q)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(Q)||T(Q)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).reverse():[]),W=(0,a.useCallback)((function(){L(!0)}),[]),X=(0,a.useCallback)((function(){L(!1)}),[]),ee=(0,a.useCallback)((function(e){e.preventDefault();var t=new FormData;if(e.dataTransfer.items){for(var n=0;n<e.dataTransfer.items.length;n++)if("file"===e.dataTransfer.items[n].kind){var a=e.dataTransfer.items[n].getAsFile();t.append("image",a)}}else for(var r=0;r<e.dataTransfer.files.length;r++)t.append("image",e.dataTransfer.files[r]);g().post("".concat(k.T,"/api/workspaces/").concat(d,"/channels/").concat(C,"/images"),t).then((function(){q(!1),localStorage.setItem("".concat(d,"-").concat(C),(new Date).getTime().toString())}))}),[d,C]),te=(0,a.useCallback)((function(e){console.log("드래그중"),e.preventDefault(),q(!0)}),[]);return I&&Z?a.createElement(l,{onDragOver:te,onDrop:ee},a.createElement(c,null,a.createElement("span",null,"#",C),a.createElement("div",{style:{display:"flex",flex:1,justifyContent:"flex-end",alignItems:"center"}},a.createElement("span",null,O&&O[0].Members.length),a.createElement(w.RYR,{onClick:W,style:{marginLeft:"5px"}}))),a.createElement(m.Z,{chatData:V,scrollbarRef:G,isReachingEnd:J,isEmpty:H,setSize:_}),a.createElement(p.Z,{chat:z,onChangeChat:M,onSubmitForm:K}),a.createElement(b.Z,{show:U,onCloseModal:X,setShowInviteChannelModal:L}),a.createElement(x.Ix,{position:"bottom-center",limit:1}),$&&a.createElement(i,null,"업로드!")):null}}}]);